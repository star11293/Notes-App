<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lecture Notes - Real-time Transcription</title>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #faf9f7 0%, #f5f3ef 100%);
      font-family: "DM Sans", -apple-system, sans-serif;
      color: #1a1a1a;
      position: relative;
    }

    .grain {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
      z-index: 0;
    }

    header {
      text-align: center;
      padding: 48px 24px 32px;
      position: relative;
      z-index: 1;
    }

    .logo-mark {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: #1a1a1a;
      color: #faf9f7;
      margin-bottom: 16px;
    }

    h1 {
      font-family: "Instrument Serif", Georgia, serif;
      font-size: 42px;
      font-weight: 400;
      margin: 0 0 8px;
      letter-spacing: -0.02em;
    }

    .subtitle {
      font-size: 16px;
      color: #6b7280;
      margin: 0;
    }

    main {
      max-width: 720px;
      margin: 0 auto;
      padding: 0 24px 64px;
      position: relative;
      z-index: 1;
    }

    .error-banner {
      display: none;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background-color: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #b91c1c;
    }

    .error-banner.visible {
      display: flex;
    }

    .recorder-card {
      background-color: #ffffff;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 8px 24px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.04);
    }

    .recorder-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #6b7280;
      transition: all 0.3s ease;
    }

    .status-dot.recording {
      background-color: #ef4444;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-text {
      font-size: 14px;
      font-weight: 500;
      color: #374151;
    }

    .timer {
      font-family: "DM Sans", monospace;
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
      letter-spacing: 0.05em;
    }

    .title-input {
      width: 100%;
      padding: 12px 0;
      font-size: 20px;
      font-family: "Instrument Serif", Georgia, serif;
      border: none;
      border-bottom: 2px solid #e5e7eb;
      background-color: transparent;
      margin-bottom: 20px;
      outline: none;
      transition: border-color 0.2s ease;
      display: none;
    }

    .title-input:focus {
      border-color: #1a1a1a;
    }

    .title-input.visible {
      display: block;
    }

    .transcript-area {
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      padding: 20px;
      background-color: #faf9f7;
      border-radius: 12px;
      margin-bottom: 24px;
      border: 1px solid #e5e7eb;
    }

    .transcript-text {
      font-size: 16px;
      line-height: 1.75;
      margin: 0;
      color: #1a1a1a;
    }

    .interim-text {
      color: #9ca3af;
      font-style: italic;
    }

    .placeholder {
      color: #9ca3af;
      font-size: 15px;
      margin: 0;
      text-align: center;
      padding-top: 60px;
    }

    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    button:hover {
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    .start-button {
      color: #ffffff;
      background-color: #1a1a1a;
    }

    .start-button:hover {
      background-color: #333;
    }

    .stop-button {
      color: #ffffff;
      background-color: #ef4444;
      display: none;
    }

    .stop-button:hover {
      background-color: #dc2626;
    }

    .save-button {
      color: #1a1a1a;
      background-color: #ffffff;
      border: 2px solid #1a1a1a;
      display: none;
    }

    .save-button:hover {
      background-color: #f3f4f6;
    }

    .notes-section {
      margin-top: 48px;
      display: none;
    }

    .notes-section.visible {
      display: block;
    }

    .section-title {
      font-family: "Instrument Serif", Georgia, serif;
      font-size: 28px;
      font-weight: 400;
      margin-bottom: 24px;
    }

    .notes-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .note-card {
      background-color: #ffffff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      border: 1px solid rgba(0,0,0,0.06);
      transition: box-shadow 0.2s ease;
    }

    .note-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .note-title {
      font-family: "Instrument Serif", Georgia, serif;
      font-size: 20px;
      font-weight: 400;
      margin: 0;
    }

    .note-meta {
      font-size: 13px;
      color: #6b7280;
    }

    .note-preview {
      font-size: 14px;
      line-height: 1.6;
      color: #4b5563;
      margin: 0 0 16px;
    }

    .note-actions {
      display: flex;
      gap: 12px;
    }

    .action-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      color: #374151;
      background-color: #f3f4f6;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      font-family: inherit;
    }

    .action-button:hover {
      background-color: #e5e7eb;
    }

    .delete-button {
      color: #dc2626;
      background-color: #fef2f2;
    }

    .delete-button:hover {
      background-color: #fee2e2;
    }
  </style>
</head>
<body>
  <div class="grain"></div>

  <header>
    <div class="logo-mark">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
        <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2"/>
        <path d="M16 8v16M10 12l6-4 6 4M10 20l6 4 6-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>
    <h1>Lecture Notes</h1>
    <p class="subtitle">Real-time transcription for your lectures</p>
  </header>

  <main>
    <div id="errorBanner" class="error-banner">
      <span>⚠</span>
      <span id="errorText"></span>
    </div>

    <div class="recorder-card">
      <div class="recorder-header">
        <div class="status-indicator">
          <span id="statusDot" class="status-dot"></span>
          <span id="statusText" class="status-text">Ready</span>
        </div>
        <div id="timer" class="timer" style="display: none;">00:00</div>
      </div>

      <input 
        type="text" 
        id="titleInput" 
        class="title-input" 
        placeholder="Lecture title..."
      >

      <div class="transcript-area">
        <p id="transcriptText" class="transcript-text"></p>
        <span id="interimText" class="interim-text"></span>
        <p id="placeholder" class="placeholder">Click "Start Recording" to begin transcribing your lecture.</p>
      </div>

      <div class="controls">
        <button id="startButton" class="start-button">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 2a3 3 0 00-3 3v5a3 3 0 106 0V5a3 3 0 00-3-3z"/>
            <path d="M5 10a1 1 0 00-2 0 7 7 0 1014 0 1 1 0 00-2 0 5 5 0 01-10 0z"/>
            <path d="M9 17v2a1 1 0 102 0v-2a1 1 0 00-2 0z"/>
          </svg>
          Start Recording
        </button>
        <button id="stopButton" class="stop-button">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <rect x="4" y="4" width="12" height="12" rx="2"/>
          </svg>
          Stop Recording
        </button>
        <button id="saveButton" class="save-button">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 13l4 4L19 7"/>
          </svg>
          Save Note
        </button>
      </div>
    </div>

    <section id="notesSection" class="notes-section">
      <h2 class="section-title">Saved Notes</h2>
      <div id="notesList" class="notes-list"></div>
    </section>
  </main>

  <script>
    // State
    let isRecording = false;
    let transcript = '';
    let recordingTime = 0;
    let currentTitle = '';
    let savedNotes = JSON.parse(localStorage.getItem('lectureNotes') || '[]');
    let recognition = null;
    let timerInterval = null;

    // Elements
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const saveButton = document.getElementById('saveButton');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const timer = document.getElementById('timer');
    const titleInput = document.getElementById('titleInput');
    const transcriptText = document.getElementById('transcriptText');
    const interimText = document.getElementById('interimText');
    const placeholder = document.getElementById('placeholder');
    const errorBanner = document.getElementById('errorBanner');
    const errorText = document.getElementById('errorText');
    const notesSection = document.getElementById('notesSection');
    const notesList = document.getElementById('notesList');

    // Initialize Speech Recognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
      showError('Speech Recognition is not supported in this browser. Please use Chrome or Edge.');
    } else {
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'en-US';

      recognition.onresult = (event) => {
        let interim = '';
        let final = '';

        for (let i = event.resultIndex; i < event.results.length; i++) {
          const result = event.results[i];
          if (result.isFinal) {
            final += result[0].transcript + ' ';
          } else {
            interim += result[0].transcript;
          }
        }

        if (final) {
          transcript += final;
          transcriptText.textContent = transcript;
        }
        interimText.textContent = interim;
        
        if (transcript || interim) {
          placeholder.style.display = 'none';
        }
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        if (event.error === 'not-allowed') {
          showError('Microphone access denied. Please allow microphone permissions and refresh the page.');
          stopRecording();
        } else if (event.error === 'no-speech') {
          // Ignore no-speech errors, just keep listening
        }
      };

      recognition.onend = () => {
        if (isRecording) {
          try {
            recognition.start();
          } catch (e) {
            console.log('Recognition restart failed:', e);
          }
        }
      };
    }

    // Functions
    function showError(message) {
      errorText.textContent = message;
      errorBanner.classList.add('visible');
    }

    function hideError() {
      errorBanner.classList.remove('visible');
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function startRecording() {
      if (!recognition) return;

      hideError();
      transcript = '';
      transcriptText.textContent = '';
      interimText.textContent = '';
      recordingTime = 0;
      
      const now = new Date();
      currentTitle = `Lecture - ${now.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      })}`;
      titleInput.value = currentTitle;

      try {
        recognition.start();
        isRecording = true;
        
        // Update UI
        statusDot.classList.add('recording');
        statusText.textContent = 'Recording';
        timer.style.display = 'block';
        timer.textContent = '00:00';
        titleInput.classList.add('visible');
        placeholder.textContent = 'Listening... Start speaking and your words will appear here.';
        placeholder.style.display = 'block';
        
        startButton.style.display = 'none';
        stopButton.style.display = 'inline-flex';
        saveButton.style.display = 'none';

        // Start timer
        timerInterval = setInterval(() => {
          recordingTime++;
          timer.textContent = formatTime(recordingTime);
        }, 1000);

      } catch (e) {
        showError('Failed to start recording. Please refresh and try again.');
      }
    }

    function stopRecording() {
      if (recognition) {
        recognition.stop();
      }
      isRecording = false;

      // Clear timer
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      // Update UI
      statusDot.classList.remove('recording');
      statusText.textContent = 'Ready';
      interimText.textContent = '';
      
      startButton.style.display = 'inline-flex';
      stopButton.style.display = 'none';
      
      if (transcript.trim()) {
        saveButton.style.display = 'inline-flex';
      }
    }

    function saveNote() {
      if (!transcript.trim()) return;

      const newNote = {
        id: Date.now(),
        title: titleInput.value || currentTitle,
        content: transcript,
        duration: recordingTime,
        createdAt: new Date().toISOString()
      };

      savedNotes.unshift(newNote);
      localStorage.setItem('lectureNotes', JSON.stringify(savedNotes));
      
      // Reset
      transcript = '';
      transcriptText.textContent = '';
      recordingTime = 0;
      timer.style.display = 'none';
      titleInput.value = '';
      titleInput.classList.remove('visible');
      placeholder.textContent = 'Click "Start Recording" to begin transcribing your lecture.';
      placeholder.style.display = 'block';
      saveButton.style.display = 'none';

      renderNotes();
    }

    function deleteNote(id) {
      savedNotes = savedNotes.filter(note => note.id !== id);
      localStorage.setItem('lectureNotes', JSON.stringify(savedNotes));
      renderNotes();
    }

    function downloadNote(note) {
      const content = `${note.title}\n${'='.repeat(note.title.length)}\n\nRecorded: ${new Date(note.createdAt).toLocaleString()}\nDuration: ${formatTime(note.duration)}\n\n${note.content}`;
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${note.title.replace(/[^a-z0-9]/gi, '_')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function renderNotes() {
      if (savedNotes.length === 0) {
        notesSection.classList.remove('visible');
        return;
      }

      notesSection.classList.add('visible');
      notesList.innerHTML = savedNotes.map(note => `
        <div class="note-card" data-id="${note.id}">
          <div class="note-header">
            <h3 class="note-title">${escapeHtml(note.title)}</h3>
            <span class="note-meta">${formatTime(note.duration)} • ${new Date(note.createdAt).toLocaleDateString()}</span>
          </div>
          <p class="note-preview">${escapeHtml(note.content.substring(0, 200))}${note.content.length > 200 ? '...' : ''}</p>
          <div class="note-actions">
            <button class="action-button" onclick="downloadNote(${JSON.stringify(note).replace(/"/g, '&quot;')})">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M8 2v8m0 0l-3-3m3 3l3-3M3 12h10"/>
              </svg>
              Download
            </button>
            <button class="action-button delete-button" onclick="deleteNote(${note.id})">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M4 4l8 8M12 4l-8 8"/>
              </svg>
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Event Listeners
    startButton.addEventListener('click', startRecording);
    stopButton.addEventListener('click', stopRecording);
    saveButton.addEventListener('click', saveNote);
    titleInput.addEventListener('input', (e) => {
      currentTitle = e.target.value;
    });

    // Initial render
    renderNotes();
  </script>
</body>
</html>
